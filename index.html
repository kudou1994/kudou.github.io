<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èµµå®‡çš„é©¬å¹´ç¥ç¦</title>
    <!-- å¼¹å¹•åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/danmaku-js@1.0.6/dist/danmaku.min.js"></script>
    <!-- GitHub API å®¢æˆ·ç«¯ -->
    <script src="https://cdn.jsdelivr.net/npm/@octokit/rest@20.0.2/dist-bundle/index.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
            font-family: 'Microsoft YaHei', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        /* å¼¹å¹•å®¹å™¨å±‚ */
        #danmaku-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }

        .container {
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            max-width: 600px;
            width: 90%;
            position: relative;
            z-index: 10;
        }

        h1 {
            color: #d63031;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .year {
            font-size: 1.5em;
            color: #e17055;
            font-weight: bold;
        }

        .blessing {
            font-size: 1.2em;
            line-height: 1.8;
            color: #2d3436;
            margin: 20px 0;
            white-space: pre-line;
        }

        .btn {
            background: #d63031;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1em;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            margin-top: 20px;
            pointer-events: auto;
        }

        .btn:hover {
            background: #c0392b;
            transform: scale(1.05);
        }

        /* å¼¹å¹•è¾“å…¥æ¡†åŒºåŸŸ */
        .danmaku-input-area {
            margin-top: 30px;
            display: flex;
            gap: 10px;
            justify-content: center;
            pointer-events: auto;
            flex-wrap: wrap;
        }

        #danmaku-input {
            padding: 10px 15px;
            border: 2px solid #fab1a0;
            border-radius: 20px;
            width: 60%;
            min-width: 200px;
            outline: none;
            font-size: 14px;
        }

        #danmaku-input:focus {
            border-color: #d63031;
        }

        #send-btn {
            background: #0984e3;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
        }

        #send-btn:hover {
            background: #74b9ff;
        }

        #send-btn:disabled {
            background: #b2bec3;
            cursor: not-allowed;
        }

        .footer {
            margin-top: 20px;
            font-size: 0.9em;
            color: #636e72;
        }

        /* çŠ¶æ€æç¤º */
        .status {
            margin-top: 15px;
            font-size: 12px;
            color: #636e72;
        }

        .status.success { color: #00b894; }
        .status.error { color: #d63031; }
        .status.loading { color: #0984e3; }

        /* å¼¹å¹•æ•°é‡æ˜¾ç¤º */
        .danmaku-count {
            margin-top: 10px;
            font-size: 13px;
            color: #d63031;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <!-- å¼¹å¹•å±‚ -->
    <div id="danmaku-container"></div>

    <div class="container">
        <h1>ğŸ é©¬å¹´å¤§å‰ ğŸ</h1>
        <div class="year">2026 ğŸ§§ ğŸ® ğŸŠ</div>
        
        <div class="blessing">
<strong>ğŸ é©¬å¹´é©¾åˆ°ï¼ŒAI åŠ æŒï¼</strong>
èµµå®‡åœ¨è¿™é‡Œç¥æ‚¨ï¼š
AI åˆ†çç¢ï¼Œé—²æ—¶ä¼´å®¶äººã€‚
æ™ºæŠ€å‚¬æ¢¦æƒ³ï¼Œåˆ›æ„ä»»é©°éª‹ã€‚
äººæœºå…±åä½œï¼Œæ™ºæ…§ç…§ä¹¾å¤ï¼
        </div>

        <button class="btn" onclick="alert('ç¥æ‚¨é©¬å¹´è¡Œå¤§è¿ Â· ä¸‡äº‹çš†å¦‚æ„ï¼âœ¨')">ğŸ æ¥æ”¶ç¥ç¦</button>

        <!-- å‘é€å¼¹å¹•åŒºåŸŸ -->
        <div class="danmaku-input-area">
            <input type="text" id="danmaku-input" placeholder="å†™ä¸‹ä½ çš„é©¬å¹´ç¥ç¦..." maxlength="50">
            <button id="send-btn" onclick="sendDanmaku()">å‘é€</button>
        </div>
        
        <div class="danmaku-count" id="danmaku-count">åŠ è½½ä¸­...</div>
        <div class="status" id="status"></div>

        <div class="footer">
            âœ¨ 2026 å†œå†é©¬å¹´ âœ¨<br>
            <small>å¼¹å¹•æ•°æ®å­˜å‚¨åœ¨ GitHub Issuesï¼Œæ‰€æœ‰äººå¯è§</small>
        </div>
    </div>

    <script>
        // ==================== é…ç½®åŒºåŸŸ ====================
        // è¯·æ›¿æ¢ä¸ºæ‚¨çš„ GitHub ä¿¡æ¯
        const GITHUB_CONFIG = {
            owner: 'kudou1994',      // ä¾‹å¦‚ï¼š'zhaoyu123'
            repo: 'kudou.github.io',              // ä¾‹å¦‚ï¼š'horse-year-blessing'
            label: 'danmaku'                 // ç”¨äºæ ‡è¯†å¼¹å¹•çš„æ ‡ç­¾
        };
        // ================================================

        // åˆå§‹åŒ–å¼¹å¹•å®ä¾‹
        const container = document.getElementById('danmaku-container');
        const danmaku = new Danmaku({
            container: container,
            speed: 6,
            opacity: 0.9,
            fontSize: 18,
            color: '#ffffff',
            borderColor: '#000000',
            zIndex: 9999,
            data: []
        });

        const statusEl = document.getElementById('status');
        const countEl = document.getElementById('danmaku-count');
        const sendBtn = document.getElementById('send-btn');
        const inputEl = document.getElementById('danmaku-input');

        // æ˜¾ç¤ºçŠ¶æ€
        function showStatus(message, type = '') {
            statusEl.textContent = message;
            statusEl.className = 'status ' + type;
        }

        // åˆå§‹åŒ– Octokit (GitHub API å®¢æˆ·ç«¯)
        const octokit = new Octokit({
            auth: undefined // æœªè®¤è¯ï¼Œä½¿ç”¨å…¬å¼€ APIï¼ˆæœ‰é€Ÿç‡é™åˆ¶ï¼‰
        });

        // å­˜å‚¨å·²æ˜¾ç¤ºçš„å¼¹å¹• IDï¼Œé¿å…é‡å¤
        const displayedIds = new Set();

        // ä» GitHub Issues åŠ è½½å¼¹å¹•
        async function loadDanmaku() {
            showStatus('æ­£åœ¨åŠ è½½å¼¹å¹•...', 'loading');
            sendBtn.disabled = true;

            try {
                const { data: issues } = await octokit.issues.listForRepo({
                    owner: GITHUB_CONFIG.owner,
                    repo: GITHUB_CONFIG.repo,
                    labels: GITHUB_CONFIG.label,
                    state: 'open',
                    per_page: 100,
                    sort: 'created',
                    direction: 'asc'
                });

                countEl.textContent = `ğŸ‰ å·²æœ‰ ${issues.length} æ¡ç¥ç¦`;
                
                // è¿‡æ»¤å¹¶æ˜¾ç¤ºå¼¹å¹•
                const comments = issues
                    .filter(issue => !displayedIds.has(issue.id))
                    .map(issue => ({
                        id: issue.id,
                        text: issue.title,
                        color: getRandomColor(),
                        mode: 'rtl'
                    }));

                // é€æ¡æ’­æ”¾
                comments.forEach((comment, index) => {
                    setTimeout(() => {
                        danmaku.push({
                            text: comment.text,
                            color: comment.color,
                            mode: 'rtl'
                        });
                        displayedIds.add(comment.id);
                    }, index * 800);
                });

                showStatus('', '');
                sendBtn.disabled = false;

            } catch (error) {
                console.error('åŠ è½½å¼¹å¹•å¤±è´¥:', error);
                showStatus('åŠ è½½å¼¹å¹•å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•', 'error');
                sendBtn.disabled = false;
            }
        }

        // å‘é€å¼¹å¹•åˆ° GitHub Issues
        async function sendDanmaku() {
            const text = inputEl.value.trim();
            
            if (!text) {
                alert("è¯·è¾“å…¥ç¥ç¦å†…å®¹ï¼");
                return;
            }

            if (text.length > 50) {
                alert("ç¥ç¦å†…å®¹ä¸èƒ½è¶…è¿‡ 50 å­—å“¦~");
                return;
            }

            sendBtn.disabled = true;
            showStatus('å‘é€ä¸­...', 'loading');

            try {
                // åˆ›å»º Issue ä½œä¸ºå¼¹å¹•
                await octokit.issues.create({
                    owner: GITHUB_CONFIG.owner,
                    repo: GITHUB_CONFIG.repo,
                    title: text,
                    labels: [GITHUB_CONFIG.label],
                    body: `æ¥è‡ªé©¬å¹´ç¥ç¦é¡µçš„å¼¹å¹•\nå‘é€æ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}`
                });

                // ç«‹å³æ˜¾ç¤ºåœ¨å±å¹•ä¸Š
                danmaku.push({
                    text: text,
                    color: '#ffd700',
                    mode: 'rtl'
                });

                inputEl.value = '';
                showStatus('å‘é€æˆåŠŸï¼ğŸ‰', 'success');
                
                // æ›´æ–°è®¡æ•°
                const currentCount = parseInt(countEl.textContent.match(/\d+/)[0]) || 0;
                countEl.textContent = `ğŸ‰ å·²æœ‰ ${currentCount + 1} æ¡ç¥ç¦`;

                setTimeout(() => showStatus('', ''), 3000);

            } catch (error) {
                console.error('å‘é€å¤±è´¥:', error);
                if (error.status === 403) {
                    showStatus('å‘é€å¤±è´¥ï¼šAPI é€Ÿç‡é™åˆ¶ï¼Œè¯·ç¨åé‡è¯•', 'error');
                } else {
                    showStatus('å‘é€å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®', 'error');
                }
            }

            sendBtn.disabled = false;
        }

        // ç”Ÿæˆéšæœºé¢œè‰²
        function getRandomColor() {
            const colors = ['#ff7675', '#74b9ff', '#55efc4', '#a29bfe', '#fd79a8', '#ffeaa7', '#81ecec'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // é¡µé¢åŠ è½½
        window.onload = () => {
            // éªŒè¯é…ç½®
            if (GITHUB_CONFIG.owner === 'æ‚¨çš„ GitHub ç”¨æˆ·å' || GITHUB_CONFIG.repo === 'æ‚¨çš„ä»“åº“å') {
                showStatus('âš ï¸ è¯·å…ˆåœ¨ä»£ç ä¸­é…ç½®æ‚¨çš„ GitHub ç”¨æˆ·åå’Œä»“åº“åï¼', 'error');
                sendBtn.disabled = true;
                countEl.textContent = 'é…ç½®æœªå®Œæˆ';
                return;
            }

            // åŠ è½½å¼¹å¹•
            loadDanmaku();

            // æ¯ 30 ç§’åˆ·æ–°ä¸€æ¬¡å¼¹å¹•
            setInterval(loadDanmaku, 30000);
        };

        // å›è½¦å‘é€
        inputEl.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                sendDanmaku();
            }
        });
    </script>
</body>
</html>
